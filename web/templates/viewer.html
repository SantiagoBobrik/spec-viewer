{{ define "content" }}
<div
  class="sticky top-0 z-10 bg-background flex items-center gap-2 text-sm text-muted-foreground w-full px-4 h-12 border-b border-transparent transition-colors duration-200"
>
  <!-- Mobile menu button -->
  <button
    type="button"
    class="btn-icon-outline size-8 shrink-0 md:hidden"
    @click="$dispatch('toggle-sidebar')"
    aria-label="Open sidebar"
  >
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="4" y1="12" x2="20" y2="12" />
      <line x1="4" y1="18" x2="20" y2="18" />
    </svg>
  </button>
  <div
    class="flex items-center gap-2 overflow-hidden hover:bg-muted/50 py-1 px-2 rounded-md transition-colors cursor-default"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="16"
      height="16"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <path
        d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14 2z"
      />
      <polyline points="14 2 14 8 20 8" />
    </svg>
    <span class="truncate font-medium">{{ .Title }}</span>
  </div>
  <div class="ml-auto flex items-center gap-1">
    {{ if .TOC }}
    <button
      type="button"
      class="btn-icon-outline size-8 shrink-0 xl:hidden"
      @click="$dispatch('toggle-toc')"
      aria-label="Toggle table of contents"
      data-tooltip="Table of contents"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="16"
        height="16"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <line x1="8" y1="6" x2="21" y2="6" />
        <line x1="8" y1="12" x2="21" y2="12" />
        <line x1="8" y1="18" x2="21" y2="18" />
        <line x1="3" y1="6" x2="3.01" y2="6" />
        <line x1="3" y1="12" x2="3.01" y2="12" />
        <line x1="3" y1="18" x2="3.01" y2="18" />
      </svg>
    </button>
    {{ end }}
    <div x-data="copyComments" x-show="hasComments" x-cloak class="inline-flex">
      <button
        type="button"
        class="btn-icon-outline size-8 shrink-0"
        @click="copyAndPurge()"
        :aria-label="copied ? 'Copied & purged' : 'Copy comments as LLM prompt'"
        data-tooltip="Copy comments"
      >
        <span x-show="!copied" class="flex items-center justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
          </svg>
        </span>
        <span x-show="copied" class="flex items-center justify-center text-green-500" style="display:none">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20 6 9 17l-5-5"/>
          </svg>
        </span>
      </button>
    </div>
    {{ template "clipboard" .Title }}
  </div>
</div>
<div x-data="smartReload" class="flex w-full">
  <div class="flex-1 min-w-0 w-full max-w-3xl mx-auto px-4 sm:px-8 md:px-20 pb-32 pt-8 md:pt-12">
    <article
      id="spec-content"
      class="prose dark:prose-invert max-w-none prose-headings:font-semibold prose-a:text-primary prose-a:no-underline hover:prose-a:underline prose-pre:bg-muted/50 prose-pre:border prose-pre:border-border"
    >
      {{ .Content }}
    </article>

    <!-- Comment popover -->
    <div
      id="comment-popover"
      x-data="commentPopover"
      @open-comment-popover.window="show($event.detail.blockIndex)"
      @click.outside="if (!$event.target.closest('.comment-indicator')) open = false"
      @keydown.escape.window="open = false"
      x-show="open"
      x-cloak
      x-transition:enter="transition ease-out duration-150"
      x-transition:enter-start="opacity-0 scale-95"
      x-transition:enter-end="opacity-100 scale-100"
      x-transition:leave="transition ease-in duration-100"
      x-transition:leave-start="opacity-100 scale-100"
      x-transition:leave-end="opacity-0 scale-95"
      class="comment-popover"
    >
      <div class="px-3 py-2 border-b border-border flex items-center justify-between">
        <span class="text-xs font-semibold uppercase tracking-wider text-muted-foreground">Comments</span>
        <button type="button" @click="open = false" class="btn-icon-outline size-6" aria-label="Close">
          <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="flex-1 overflow-y-auto px-3 py-2 flex flex-col gap-2">
        <template x-for="c in comments" :key="c.id">
          <div class="flex items-start gap-2 text-sm group">
            <p class="flex-1 break-words" x-text="c.text"></p>
            <button
              type="button"
              @click="deleteComment(c.id)"
              class="shrink-0 opacity-0 group-hover:opacity-100 transition-opacity text-destructive-foreground hover:text-destructive"
              aria-label="Delete comment"
            >
              <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
              </svg>
            </button>
          </div>
        </template>
        <div x-show="comments.length === 0" class="text-xs text-muted-foreground italic">No comments yet</div>
      </div>
      <div class="px-3 py-2 border-t border-border">
        <textarea
          x-model="newComment"
          @keydown.meta.enter="addComment()"
          @keydown.ctrl.enter="addComment()"
          placeholder="Add a comment..."
          rows="2"
          class="w-full text-sm bg-muted/50 border border-border rounded-md px-2 py-1.5 resize-none focus:outline-none focus:ring-1 focus:ring-ring"
        ></textarea>
        <div class="flex items-center justify-between mt-1.5">
          <span class="text-[10px] text-muted-foreground">Cmd+Enter to submit</span>
          <button type="button" @click="addComment()" class="btn-primary text-xs px-2 py-1 h-auto">Add</button>
        </div>
      </div>
    </div>
  </div>

  {{ if .TOC }}
  <aside
    x-data="{ open: true }"
    @toggle-toc.window="open = !open"
    class="hidden xl:block sticky top-12 h-[calc(100vh-3rem)] w-64 shrink-0 border-l border-border overflow-y-auto"
  >
    <nav x-show="open" x-transition class="p-4">
      <h3 class="text-xs font-semibold uppercase tracking-wider text-muted-foreground mb-3">
        On this page
      </h3>
      <ul class="flex flex-col gap-1 text-sm">
        {{ range .TOC }}
        <li style="padding-left: {{ printf "%d" (multiply (subtract .Level 1) 12) }}px">
          <a
            href="#{{ .ID }}"
            class="block py-1 text-muted-foreground hover:text-foreground transition-colors truncate"
          >
            {{ .Text }}
          </a>
        </li>
        {{ end }}
      </ul>
    </nav>
  </aside>

  <!-- Mobile/tablet TOC overlay -->
  <div
    x-data="{ mobileOpen: false }"
    @toggle-toc.window="mobileOpen = !mobileOpen"
    class="xl:hidden"
  >
    <div
      x-show="mobileOpen"
      x-transition:enter="transition ease-out duration-200"
      x-transition:enter-start="translate-x-full"
      x-transition:enter-end="translate-x-0"
      x-transition:leave="transition ease-in duration-150"
      x-transition:leave-start="translate-x-0"
      x-transition:leave-end="translate-x-full"
      @click.outside="mobileOpen = false"
      class="fixed top-12 right-0 h-[calc(100vh-3rem)] w-72 bg-background border-l border-border shadow-lg overflow-y-auto z-20"
    >
      <nav class="p-4">
        <div class="flex items-center justify-between mb-3">
          <h3 class="text-xs font-semibold uppercase tracking-wider text-muted-foreground">
            On this page
          </h3>
          <button
            type="button"
            @click="mobileOpen = false"
            class="btn-icon-outline size-6"
            aria-label="Close table of contents"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <line x1="18" y1="6" x2="6" y2="18" />
              <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
          </button>
        </div>
        <ul class="flex flex-col gap-1 text-sm">
          {{ range .TOC }}
          <li style="padding-left: {{ printf "%d" (multiply (subtract .Level 1) 12) }}px">
            <a
              href="#{{ .ID }}"
              @click="mobileOpen = false"
              class="block py-1 text-muted-foreground hover:text-foreground transition-colors truncate"
            >
              {{ .Text }}
            </a>
          </li>
          {{ end }}
        </ul>
      </nav>
    </div>
  </div>
  {{ end }}
</div>
{{ end }}
