{{ define "sidebar" }}
<div
  class="h-full flex flex-col gap-6 p-4"
  x-data="{
    search: '',
    filterItems() {
      const term = this.search.toLowerCase().trim();
      const nav = this.$refs.specNav;
      if (!nav) return;

      // Get all spec file links
      const items = nav.querySelectorAll('[data-spec-name]');
      // Get all folder containers
      const folders = nav.querySelectorAll('[data-sidebar-folder]');

      if (!term) {
        // Show everything when search is empty
        items.forEach(el => el.style.display = '');
        folders.forEach(el => el.style.display = '');
        return;
      }

      // First hide all items and folders
      items.forEach(el => el.style.display = 'none');
      folders.forEach(el => el.style.display = 'none');

      // Show folders whose name matches (with all their children)
      folders.forEach(folder => {
        const name = folder.getAttribute('data-folder-name').toLowerCase();
        if (name.includes(term)) {
          folder.style.display = '';
          folder.querySelectorAll('[data-sidebar-folder]').forEach(f => f.style.display = '');
          folder.querySelectorAll('[data-spec-name]').forEach(f => f.style.display = '');
        }
      });

      // Show matching file items and their parent folders
      items.forEach(el => {
        const name = el.getAttribute('data-spec-name').toLowerCase();
        if (name.includes(term)) {
          el.style.display = '';
          let parent = el.parentElement;
          while (parent && parent !== nav) {
            if (parent.hasAttribute('data-sidebar-folder')) {
              parent.style.display = '';
            }
            parent = parent.parentElement;
          }
        }
      });
    }
  }"
>
  <div class="flex items-center gap-2 px-2">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
      class="h-6 w-6"
    >
      <path
        d="M15 6v12a3 3 0 1 0 3-3H6a3 3 0 1 0 3 3V6a3 3 0 1 0-3 3h12a3 3 0 1 0-3-3"
      ></path>
    </svg>
    <span class="font-bold">Spec Viewer</span>
  </div>

  <!-- Search Input -->
  <div class="relative px-1">
    <svg
      class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground pointer-events-none"
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 24 24"
      stroke="currentColor"
      stroke-width="2"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M21 21l-4.35-4.35M11 19a8 8 0 100-16 8 8 0 000 16z"
      />
    </svg>
    <input
      type="text"
      x-model="search"
      @input="filterItems()"
      placeholder="Filter specs..."
      class="w-full pl-8 pr-8 py-1.5 text-sm rounded-md border border-input bg-background text-foreground placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-0"
    />
    <button
      x-show="search.length > 0"
      x-cloak
      @click="search = ''; filterItems()"
      class="absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground"
      aria-label="Clear search"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="w-4 h-4"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
        stroke-width="2"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M6 18L18 6M6 6l12 12"
        />
      </svg>
    </button>
  </div>

  <nav x-ref="specNav" class="flex-1 overflow-y-auto flex flex-col gap-2">
    {{ if .Specs }} {{ range .Specs }} {{ template "sidebar_item" . }} {{ end }}
    {{ else }}
    <div class="px-2 text-sm text-muted-foreground">No specs found.</div>
    {{ end }}
  </nav>

  <div class="mt-auto">{{ template "themeswitcher" . }}</div>
</div>
{{ end }} {{ define "sidebar_item" }} {{ if .IsDir }}
<div class="flex flex-col gap-1" data-sidebar-folder data-folder-name="{{ .Name }}">
  <!-- Folder Header -->
  <div
    class="flex items-center text-sm font-medium text-muted-foreground px-2 py-1"
  >
    <svg
      class="w-4 h-4 mr-2"
      fill="none"
      stroke="currentColor"
      viewBox="0 0 24 24"
      xmlns="http://www.w3.org/2000/svg"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"
      ></path>
    </svg>
    {{ .Name }}
  </div>
  <!-- Children -->
  <div class="flex flex-col gap-1 pl-4 border-l border-border/40 ml-2">
    {{ range .Children }} {{ template "sidebar_item" . }} {{ end }}
  </div>
</div>
{{ else }}
<a
  href="/view?file={{ .Path }}"
  data-spec-name="{{ .Name }}"
  class="flex items-center text-sm gap-2 py-1.5 px-2 rounded-md transition-colors group/item {{ if .Active }}bg-accent text-accent-foreground font-medium{{ else }}text-muted-foreground hover:bg-accent hover:text-accent-foreground{{ end }}"
>
  <svg
    class="w-4 h-4 shrink-0"
    fill="none"
    stroke="currentColor"
    viewBox="0 0 24 24"
    xmlns="http://www.w3.org/2000/svg"
  >
    <path
      stroke-linecap="round"
      stroke-linejoin="round"
      stroke-width="2"
      d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
    ></path>
  </svg>
  <span class="truncate">{{ .Name }}</span>
</a>
{{ end }} {{ end }}
